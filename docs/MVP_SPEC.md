# MVP仕様書

## 概要

本ドキュメントは「マチマチマッチング」のMVP（Minimum Viable Product）の仕様を定義します。

---

## 技術スタック

| レイヤー | 技術 |
|---------|------|
| Frontend | Vue 3 + TypeScript + Pinia + Tailwind CSS + Vite |
| Backend | Express + TypeScript |
| API | REST API |
| Database | PostgreSQL + Prisma ORM |
| Realtime | Socket.io（チャット用） |
| Auth | Supabase Auth（メール + Google OAuth） |
| Storage | Supabase Storage（プロフィール画像） |
| Hosting | Vercel（FE）+ Railway（BE）+ Supabase（DB） |

---

## 対象エリア

- 東京
- 仙台

---

## 機能一覧

### 1. 認証・ユーザー管理

| 機能 | 詳細 | 優先度 |
|------|------|--------|
| ユーザー登録 | メール or Google OAuth | 必須 |
| ログイン/ログアウト | Supabase Authによるセッション管理 | 必須 |
| プロフィール設定 | ニックネーム、アイコン画像、自己紹介 | 必須 |
| プロフィール画像アップロード | Supabase Storageに保存 | 必須 |
| 興味カテゴリ設定 | 固定リストから複数選択 | 必須 |
| 活動エリア設定 | 東京 / 仙台 から選択 | 必須 |
| プロフィール編集 | 設定内容の変更 | 必須 |

### 2. やりたいこと表明

| 機能 | 詳細 | 優先度 |
|------|------|--------|
| 表明作成 | カテゴリ、時期、ひとこと | 必須 |
| 表明一覧 | 自分の表明中リスト表示 | 必須 |
| 表明編集 | 内容の修正 | 必須 |
| 表明削除 | 手動削除 | 必須 |
| 期限延長 | 期限切れ前に延長（+7日） | 必須 |
| 自動期限切れ | 1週間で自動でステータス変更 | 必須 |
| ホーム画面表示 | 現在の表明をホームに表示 | 必須 |

### 3. 募集

| 機能 | 詳細 | 優先度 |
|------|------|--------|
| 募集作成 | タイトル、カテゴリ、日時、場所、人数 | 必須 |
| 募集一覧 | カード形式で一覧表示 | 必須 |
| フィルタリング | カテゴリ、エリアで絞り込み | 必須 |
| 募集詳細 | 詳細情報表示 | 必須 |
| 募集編集 | 自分の募集の内容修正 | 必須 |
| 募集削除 | 自分の募集の削除 | 必須 |
| 手動締め切り | 募集者が任意のタイミングで締め切り | 必須 |
| 自動締め切り | 最大人数に達したら自動締め切り | 必須 |

### 4. 参加申請（ユーザー → 募集者）

| 機能 | 詳細 | 優先度 |
|------|------|--------|
| 参加申請送信 | 募集詳細から申請 | 必須 |
| 申請一覧（募集者側） | 受け取った申請の一覧 | 必須 |
| 申請承認 | 募集者が承認 → グループに追加 | 必須 |
| 申請却下 | 募集者が却下 | 必須 |
| 申請状態確認（申請者側） | 自分の申請状況を確認 | 必須 |

### 5. オファー（募集者 → ユーザー）

| 機能 | 詳細 | 優先度 |
|------|------|--------|
| ユーザー提案 | 募集に合うユーザーをスコア順で提案 | 必須 |
| やりたい表明ブースト | 表明中ユーザーを優先表示 | 必須 |
| オファー送信 | ワンタップで誘う | 必須 |
| オファー受信一覧 | ホーム画面に表示 | 必須 |
| オファー応答 | 参加 / パス を選択 | 必須 |

### 6. マッチング

| 機能 | 詳細 | 優先度 |
|------|------|--------|
| スコアリング | カテゴリ、エリア、表明状態で計算 | 必須 |
| 募集マッチ通知 | 表明にマッチする募集を通知 | 必須 |

#### マッチングスコア計算式

```typescript
function calculateMatchScore(user: User, recruitment: Recruitment): number {
  let score = 0;

  // カテゴリマッチ（必須条件）
  if (!user.categories.includes(recruitment.categoryId)) {
    return 0;
  }
  score += 30;

  // エリアマッチ（必須条件）
  if (user.area !== recruitment.area) {
    return 0;
  }
  score += 20;

  // やりたいこと表明中ブースト（重要）
  const activeWantToDo = user.wantToDos.find(
    w => w.categoryId === recruitment.categoryId && w.status === 'ACTIVE'
  );
  if (activeWantToDo) {
    score += 40; // 大幅ブースト

    // 時期マッチでさらにブースト
    if (isTimingMatch(activeWantToDo.timing, recruitment.datetime)) {
      score += 10;
    }
  }

  return score; // 最大100点
}
```

### 7. グループ

| 機能 | 詳細 | 優先度 |
|------|------|--------|
| グループ自動作成 | 最初の参加者確定時に作成 | 必須 |
| グループ一覧 | 参加中グループ一覧 | 必須 |
| メンバー一覧 | グループ内のメンバー表示 | 必須 |
| リアルタイムチャット | Socket.ioでメッセージ送受信 | 必須 |
| 未読カウント | 未読メッセージ数表示 | 必須 |

### 8. 通知

| 機能 | 詳細 | 優先度 |
|------|------|--------|
| アプリ内通知 | オファー、申請、メッセージ等 | 必須 |
| 通知一覧 | 通知履歴表示 | 必須 |
| 未読/既読管理 | 既読にする機能 | 必須 |
| 通知ベル | ヘッダーに未読数表示 | 必須 |

---

## カテゴリ一覧（固定）

| ID | アイコン | 名前 |
|----|---------|------|
| 1 | 🎲 | ボードゲーム |
| 2 | ☕ | カフェ |
| 3 | 🍺 | 飲み会 |
| 4 | ⚽ | スポーツ |
| 5 | 🎮 | ゲーム |
| 6 | 🎬 | 映画 |
| 7 | 📚 | 読書 |
| 8 | 🎵 | 音楽 |
| 9 | 🏃 | ランニング |
| 10 | 🏋️ | 筋トレ |
| 11 | 🧘 | ヨガ |
| 12 | 📷 | カメラ |
| 13 | 🎨 | アート |
| 14 | 💻 | プログラミング |
| 15 | 🗣️ | 勉強会 |

---

## 画面一覧（MVP）

### 認証・オンボーディング（4画面）

1. **スプラッシュ画面** - ローディング、認証状態チェック
2. **ログイン画面** - メール/Google OAuth
3. **新規登録画面** - メールアドレス登録
4. **初期設定画面** - プロフィール、カテゴリ、エリア設定（Step形式）

### メイン（3画面）

5. **ホーム画面** - 今やりたいこと、オファー、おすすめ募集
6. **通知画面** - 通知一覧
7. **募集一覧画面** - フィルタ付き募集リスト

### やりたいこと表明（2画面）

8. **表明一覧・管理画面** - 自分の表明リスト
9. **表明作成モーダル** - カテゴリ、時期、ひとこと入力

### 募集（3画面）

10. **募集作成画面** - フォーム入力
11. **募集詳細画面** - 詳細表示、参加申請ボタン
12. **ユーザー提案画面** - 募集作成後のオファー送信

### グループ（2画面）

13. **グループ一覧画面** - 参加中グループ
14. **グループチャット画面** - リアルタイムチャット

### プロフィール（2画面）

15. **マイページ** - プロフィール表示
16. **プロフィール編集画面** - 設定変更

### 合計: 16画面

---

## ステータス定義

### 募集ステータス

| ステータス | 説明 |
|-----------|------|
| OPEN | 募集中 |
| CLOSED | 締め切り（グループ確定） |
| COMPLETED | イベント実施済み |
| CANCELLED | 募集者が取り消し |

### やりたいこと表明ステータス

| ステータス | 説明 |
|-----------|------|
| ACTIVE | 有効（マッチング対象） |
| EXPIRED | 期限切れ |
| DELETED | ユーザーが削除 |

### 参加申請ステータス

| ステータス | 説明 |
|-----------|------|
| PENDING | 承認待ち |
| APPROVED | 承認済み |
| REJECTED | 却下 |
| CANCELLED | 申請者がキャンセル |

### オファーステータス

| ステータス | 説明 |
|-----------|------|
| PENDING | 回答待ち |
| ACCEPTED | 承諾（参加確定） |
| DECLINED | 辞退 |
| EXPIRED | 期限切れ |

---

## MVP対象外（Phase 2以降）

| 機能 | 理由 |
|------|------|
| プッシュ通知 | Firebase設定の複雑さ |
| ブロック・通報機能 | 初期はユーザー数が少ない |
| 日程調整機能 | チャットで代替可能 |
| ユーザー評価・レビュー | 初期は不要 |
| 追加エリア | まず2エリアで検証 |
| 下書き機能 | シンプルさ優先 |
| LINE OAuth | まずGoogle + メールで |

---

## 非機能要件

### パフォーマンス

- ページロード: 3秒以内
- API応答: 500ms以内
- チャットメッセージ遅延: 1秒以内

### セキュリティ

- 認証: Supabase Auth + JWT
- 認可: Row Level Security (RLS)
- 入力検証: Zod
- XSS: Vue 3のデフォルトエスケープ
- CSRF: SameSite Cookie
- レート制限: express-rate-limit

### 可用性

- 目標稼働率: 99%（個人開発のため）
