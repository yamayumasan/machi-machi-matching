# Devç’°å¢ƒ ã‚¤ãƒ³ãƒ•ãƒ©æ§‹æˆ

## æ¦‚è¦

ãƒãƒãƒãƒãƒãƒƒãƒãƒ³ã‚°ã®devç’°å¢ƒã‚’ä»¥ä¸‹ã®æ§‹æˆã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¾ã™ã€‚

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Vercel      â”‚     â”‚     Railway     â”‚     â”‚    Supabase     â”‚
â”‚   (Frontend)    â”‚â”€â”€â”€â”€â–¶â”‚    (Backend)    â”‚â”€â”€â”€â”€â–¶â”‚   (Database)    â”‚
â”‚   Vue 3 + Vite  â”‚     â”‚   Express.js    â”‚     â”‚   PostgreSQL    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   + Auth        â”‚
                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é¸å®šç†ç”±

| ã‚µãƒ¼ãƒ“ã‚¹ | é¸å®šç†ç”± |
|---------|---------|
| **Vercel** | Vue/Viteã¨ã®ç›¸æ€§ãŒè‰¯ã„ã€ç„¡æ–™æ ãŒå……å®Ÿã€è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ |
| **Railway** | Node.jsãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«æœ€é©ã€$5/æœˆã®ç„¡æ–™ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã€ä½¿ç”¨é‡åˆ¶é™è¨­å®šå¯èƒ½ |
| **Supabase** | æ—¢ã«Authã§ä½¿ç”¨ä¸­ã€ç„¡æ–™æ ã§PostgreSQLåˆ©ç”¨å¯èƒ½ã€ã‚¹ã‚±ãƒ¼ãƒ«æ™‚ã‚‚ç§»è¡Œä¸è¦ |

### ã‚³ã‚¹ãƒˆç®¡ç†

- **Vercel**: Hobbyãƒ—ãƒ©ãƒ³ï¼ˆç„¡æ–™ï¼‰ã§ååˆ†
- **Railway**: æœˆ$5ã®ç„¡æ–™ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆå†…ã§é‹ç”¨ã€ä½¿ç”¨é‡åˆ¶é™ã‚’è¨­å®š
- **Supabase**: ç„¡æ–™ãƒ—ãƒ©ãƒ³ã§é–‹å§‹ï¼ˆ500MB DBã€50K MAU Authï¼‰

---

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### Step 1: Supabase æ¥ç¶šæƒ…å ±ã®ç¢ºèª

**çŠ¶æ…‹**: âœ… å®Œäº†

> **æ–¹é‡**: æ—¢å­˜ã®Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ `machi-machi-matching` ã‚’devç’°å¢ƒã¨ã—ã¦ä½¿ç”¨ã€‚
> æœ¬ç•ªé‹ç”¨æ™‚ã«æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ç§»è¡Œã™ã‚‹ã€‚

#### 1.1 æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ¥ç¶šæƒ…å ±ã‚’ç¢ºèª

1. [Supabase Dashboard](https://supabase.com/dashboard) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. `machi-machi-matching` ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠ

3. **Settings** â†’ **Database** ã«ç§»å‹•
   - ã€ŒConnection stringã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰URIã‚’ã‚³ãƒ”ãƒ¼

4. **Settings** â†’ **API** ã«ç§»å‹•
   - **Project URL**: `https://[PROJECT-REF].supabase.co`
   - **anon public key**: `eyJ...`
   - **service_role key**: `eyJ...`

#### 1.2 Authè¨­å®šã®æ›´æ–°

1. **Authentication** â†’ **URL Configuration** ã«ç§»å‹•
2. **Redirect URLs** ã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼ˆå¾Œã§Vercelã®URLã«æ›´æ–°ï¼‰:
   - `http://localhost:5173/**`ï¼ˆæ—¢å­˜ï¼‰
   - Vercel URLã¯ Step 3 å®Œäº†å¾Œã«è¿½åŠ 

---

### Step 2: Railway ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šï¼ˆAPIï¼‰

**çŠ¶æ…‹**: ğŸ”„ é€²è¡Œä¸­

#### 2.1 Railwayã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆãƒ»ãƒ­ã‚°ã‚¤ãƒ³

1. [Railway](https://railway.app/) ã«ã‚¢ã‚¯ã‚»ã‚¹
2. GitHubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆæ¨å¥¨ï¼‰
3. åˆå›ã®å ´åˆã€ç„¡æ–™ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆï¼ˆ$5/æœˆï¼‰ãŒä»˜ä¸ã•ã‚Œã‚‹

#### 2.2 æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

1. Dashboardã§ã€ŒNew Projectã€ã‚’ã‚¯ãƒªãƒƒã‚¯
2. ã€ŒDeploy from GitHub repoã€ã‚’é¸æŠ
3. `machi-machi-matching` ãƒªãƒã‚¸ãƒˆãƒªã‚’é¸æŠ
4. **Root Directory** ã¯è¨­å®šä¸è¦ï¼ˆ`railway.json`ã§åˆ¶å¾¡ï¼‰

#### 2.3 ãƒ“ãƒ«ãƒ‰è¨­å®š

`railway.json` ãŒãƒªãƒã‚¸ãƒˆãƒªãƒ«ãƒ¼ãƒˆã«é…ç½®æ¸ˆã¿ã€‚è‡ªå‹•ã§ä»¥ä¸‹ãŒå®Ÿè¡Œã•ã‚Œã‚‹:

```json
{
  "build": {
    "buildCommand": "pnpm install && pnpm --filter @machi/shared build && pnpm --filter @machi/api prisma:generate && pnpm --filter @machi/api build"
  },
  "deploy": {
    "startCommand": "pnpm --filter @machi/api start",
    "healthcheckPath": "/api/health"
  }
}
```

#### 2.4 ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã€ŒVariablesã€ã‚¿ãƒ–ã§ä»¥ä¸‹ã‚’è¨­å®š:

| å¤‰æ•°å | å€¤ |
|--------|-----|
| `DATABASE_URL` | Supabaseã®æ¥ç¶šæ–‡å­—åˆ— |
| `SUPABASE_URL` | `https://[PROJECT-REF].supabase.co` |
| `SUPABASE_SERVICE_ROLE_KEY` | Service Role Key |
| `NODE_ENV` | `production` |
| `CORS_ORIGIN` | `*`ï¼ˆå¾Œã§Vercel URLã«å¤‰æ›´ï¼‰ |

#### 2.5 ä½¿ç”¨é‡åˆ¶é™ã®è¨­å®šï¼ˆé‡è¦ï¼‰

1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š â†’ **Usage Limits** ã«ç§»å‹•
2. ä»¥ä¸‹ã‚’è¨­å®š:
   - **Monthly spending limit**: `$5`ï¼ˆç„¡æ–™ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆå†…ã«åã‚ã‚‹ï¼‰
   - **Email alerts**: æœ‰åŠ¹åŒ–

#### 2.6 ãƒ‡ãƒ—ãƒ­ã‚¤ç¢ºèª

1. ãƒ‡ãƒ—ãƒ­ã‚¤ãŒå®Œäº†ã—ãŸã‚‰URLã‚’ç¢ºèªï¼ˆä¾‹: `https://xxx.up.railway.app`ï¼‰
2. `https://xxx.up.railway.app/api/health` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦å‹•ä½œç¢ºèª

---

### Step 3: Vercel ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šï¼ˆWebï¼‰

**çŠ¶æ…‹**: â³ æœªç€æ‰‹

<!-- å®Œäº†å¾Œã«è¨˜è¼‰ -->

---

### Step 4: ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

**çŠ¶æ…‹**: â³ æœªç€æ‰‹

<!-- å®Œäº†å¾Œã«è¨˜è¼‰ -->

---

### Step 5: ãƒ‡ãƒ—ãƒ­ã‚¤ç¢ºèª

**çŠ¶æ…‹**: â³ æœªç€æ‰‹

<!-- å®Œäº†å¾Œã«è¨˜è¼‰ -->

---

## ç’°å¢ƒå¤‰æ•°ä¸€è¦§

### API (Railway)

| å¤‰æ•°å | èª¬æ˜ | ä¾‹ |
|--------|------|-----|
| `DATABASE_URL` | PostgreSQLæ¥ç¶šæ–‡å­—åˆ— | `postgresql://...` |
| `SUPABASE_URL` | Supabase URL | `https://xxx.supabase.co` |
| `SUPABASE_SERVICE_ROLE_KEY` | Service Role Key | `eyJ...` |
| `NODE_ENV` | ç’°å¢ƒ | `production` |
| `PORT` | ãƒãƒ¼ãƒˆï¼ˆRailwayè‡ªå‹•è¨­å®šï¼‰ | `3000` |
| `CORS_ORIGIN` | CORSã‚ªãƒªã‚¸ãƒ³ | Vercel URL |

### Web (Vercel)

| å¤‰æ•°å | èª¬æ˜ | ä¾‹ |
|--------|------|-----|
| `VITE_API_BASE_URL` | APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | Railway URL |
| `VITE_SUPABASE_URL` | Supabase URL | `https://xxx.supabase.co` |
| `VITE_SUPABASE_ANON_KEY` | Anon Key | `eyJ...` |

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

<!-- å•é¡Œç™ºç”Ÿæ™‚ã«è¿½è¨˜ -->

---

## æ›´æ–°å±¥æ­´

| æ—¥ä»˜ | å†…å®¹ |
|------|------|
| 2026-01-04 | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆã€Step 1 é–‹å§‹ |
